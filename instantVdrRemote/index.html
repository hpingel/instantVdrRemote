<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html
      PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>

        <!-- 
        
          ****************************************************
          instantVdrRemote 0.2-pre
          ****************************************************
          
          (c) 2013 Henning Pingel ( hepi at yavdr dot org )
          
          An easy to use virtual VDR remote control to be used
          on tablets, smartphones and various web browsers
          fully configurable and customizable
          
          needs VDR plugin restfulapi to be installed 
           
          ****************************************************
          
          This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License
          http://creativecommons.org/licenses/by-nc-sa/3.0/

          ****************************************************
          
          instantVdrRemote makes use of jQuery and jQuery Mobile
          http://jquery.com/
          http://jquerymobile.com/
          
          ****************************************************
          
        --> 
          
        <title>instantVdrRemote 0.2-pre</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
        <link rel="stylesheet" href="jqm-icon-pack-3.0.0-fa.css" />
        <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
        <script src="config.js"></script>
        <style>
        
            /*@media all and (max-width: 35em) {*/
            @media all and (max-width: 50em) {
                .virtualRemoteBreakpoint #virtualRemoteBlock1, 
                .virtualRemoteBreakpoint #virtualRemoteBlock2, 
                .virtualRemoteBreakpoint #virtualRemoteBlock3, 
                .virtualRemoteBreakpoint #virtualRemoteBlock4{ 
                    width: 100%; 
                    float:none; 
                }
            }
            a#virtRemoteKey-Power {
                background-image: none;
                background-color: red;
            } 
            a#virtRemoteKey-Record{
                background-image: none;
                background-color: red;
            } 
            a#virtRemoteKey-Red{
                background-image: none;
                background-color: red;
            } 
            a#virtRemoteKey-Green{
                background-image: none;
                background-color: green;
            } 
            a#virtRemoteKey-Yellow{
                background-image: none;
                background-color: yellow;
            }
            a#virtRemoteKey-Blue{
                background-image: none;
                background-color: blue;
            }
            
        </style>
        <script>

    $(document).ready(function(){
        
        inflateRemote();
        fillPanel( "left");
        fillPanel( "right");
        
        if ( typeof(host) === "undefined" || host === ""){
            $("#popupHost").popup("open");
        }

        $( "#buttonHostOK" ).on( "click", function() {
            host = "http://" + $("#host-field").val() + ":" +$("#port-field").val();
        });

        $( ".virtRemoteKey" ).on( "click", function() {
            if ( typeof(host) === "undefined" || host === ""){
                $("#popupHost").popup("open");
            }
            else{
                processVirtualRemoteKeypress( $( this ).attr( "id" ).split('-')[1] );
            }
        });
        $( ".ivrKey" ).on( "click", function() {
            if ( typeof(host) === "undefined" || host === ""){
                $("#popupHost").popup("open");
            }
            else{
                var key = $( this ).attr( "id" ).split('-')[1];
                if (key == "ClosePanel_right"){
                    $( "#rightPanel" ).panel( "close" );
                }
                if (key == "ClosePanel_left"){
                    $( "#leftPanel" ).panel( "close" );
                }
            }
        });
        
    });


    function processVirtualRemoteKeypress( key ){
        //alert("processVirtualRemoteKeypress: " + key);
        $.ajax({
                type: "POST",
                url: host + "/remote/" + key,
                timeout: 300
            }).done(function( xml) {
                //todo...
            }).fail(function( jqXHR, textStatus, errorThrown){
               // if (textStatus === "timeout"){
               $("#popupHost").popup("open");
               //}
            });
    }
    
    function inflateRemote(){
        var markup ='',
            areaCount = 0, buttonKey, caption,
            gridType, buttonCount, rowLength,
            container, area, row, button;

        for ( container in remoteLayout){
            markup += '<div class="ui-grid-a virtualRemoteBreakpoint">';
            for ( area in remoteLayout[container]){
                areaCount++;
                markup += '<div class="ui-block-'+ String.fromCharCode(96 + areaCount) + 
                          '" id="virtualRemoteBlock'+areaCount+'">'+
                          //'<div class="ui-body ui-body-b">'+
                          '';
                markup += renderSimpleGridAreaContent( remoteLayout[container][area] );
                markup += '</div>';//+'</div>';
            }
            markup += '</div>';
        }
        $content = $("#pageContent");
        $content.append( markup );
        $content.trigger("create");
    }

function renderSimpleGridAreaContent( area ){
    var markup = "";
    for ( row in area){
        rowLength = area[row].length;
        if ( rowLength === 0) 
            alert("Error: row contains no buttons at all, skipping it!");
        else{
            if ( rowLength > 5 ) alert("Error: row contains more than five buttons!");
            gridType = (rowLength > 1 && rowLength < 6) ? String.fromCharCode(95 + rowLength) : 'solo';
            markup += '<div class="ui-grid-'+ gridType + '">';
            buttonCount = 0;
            for ( button in area[row]){
                buttonCount++;
                buttonKey = $.trim(area[row][button]);
                markup += '<div class="ui-block-'+ String.fromCharCode( 96 + buttonCount )+'">';
                if ( buttonKey !== "" && typeof(buttonConfig[ buttonKey ]) === "object"){
                    caption = buttonCaptions[ buttonKey ] ? buttonCaptions[ buttonKey ] : buttonKey; 
                    markup += getButtonMarkup( buttonKey, caption, buttonConfig[ buttonKey ].icon, buttonConfig[ buttonKey ].theme, "virtRemoteKey" );
                }
                else if ( buttonKey.substring(0,4) === "ivr_"){
                    key = buttonKey.substring(4);
                    markup += getButtonMarkup( key, ivrButton[key].caption, ivrButton[key].icon, ivrButton[key].theme, "ivrKey");
                }
                
                else if ( buttonKey !== "" && typeof (buttonConfig[ buttonKey ]) === "undefined"){
                    alert("ERROR: Button '" + buttonKey + "' is not a legal value!");
                }
                markup += '</div>';
            }
            markup += '</div>';
        }
    }
    return markup;
}

function getButtonMarkup( buttonKey, caption, icon, theme, buttonType ){
    return '<a class="'+buttonType+'" id="' + buttonType + '-' + buttonKey +
              '" data-role="button" href="#" data-icon="' + icon + 
              '" data-iconpos="top" data-theme="'+ theme +
              '" data-mini="true">'+
              caption + '</a>';
}

function fillPanel( side ){
    var content = panelContent[side];
    content.push( [ "ivr_ClosePanel_" + side ] );
    var markup = renderSimpleGridAreaContent( content ); 
    $panel = $( "#" + side + "Panel" );
    $content = $( "#" + side + "PanelContent" );
    $content.replaceWith( markup );
    //$panel.trigger("updatelayout");
    $panel.trigger("create");
}

        </script>
    </head>
<body>
    <div id="virtualremote" data-role="page" data-theme="a">
    
        <div data-role="header" data-position="fixed">
            <h1>instantVdrRemote</h1>
            <a href="#leftPanel" data-icon="resize-horizontal">Left panel</a>
            <a href="#rightPanel" data-icon="resize-horizontal">Right panel</a>
            <div data-role="navbar" data-iconpos="left">
                <ul>
                    <!-- li><a href="#virtualremote" class="ui-btn-active ui-state-persist">Remote</a></li  -->
                    <li><a href="#virtualremote" class="ui-btn-active ui-state-persist">Remote</a></li>
                    <li><a href="#cutterTablePage" data-icon="cut">Cutter table</a></li>
                    <li><a href="#keyMacroPage" data-icon="cut">Key macros</a></li>
                </ul>
            </div>
        </div>
            
        <div data-role="content" id="pageContent">
            <div data-role="popup" id="popupHost" data-theme="a" class="ui-corner-all" data-history="false" data-dismissible="false">
                <form>
                    <div style="padding:10px 20px;">
                      <h3>Please provide the internal host name or IP address of your VDR</h3>
                      <p>This demo only works as long as you launch it from your local area network.<br/>You can add the host in the source code of this HTML file permanently.</p>
                      <label for="host">Host name or IP address:</label>
                      <input type="text" name="host" id="host-field" value="192.168.1.123" placeholder="192.168.1.123" data-theme="a" />
    
                      <label for="port">Port of restfulapi plugin:</label>
                      <input type="text" name="port" id="port-field" value="8002" placeholder="8002" data-theme="a" />
    
                      <div><a data-role="button" data-theme="c" data-inline="true" data-rel="back">Cancel</a>
                      <a id="buttonHostOK" data-role="button" data-theme="b" data-inline="true" data-rel="back">OK</a></div>
                    </div>
                </form>
            </div>
       </div><!--  end of page content -->
        
        <div data-role="footer" data-position="fixed" style="text-align: center;">
            <div data-enhance="false">
                <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">
                    <img data-enhance="false" alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" />
                </a>
            </div>
        </div>
        <div data-role="panel" id="leftPanel" data-position="left" data-theme="c" data-display="overlay">
           <div id="leftPanelContent"></div>
        </div>
        <div data-role="panel" id="rightPanel" data-position="right" data-theme="c" data-display="overlay">
           <div id="rightPanelContent"></div>
        </div>
    </div><!--  page end -->

</body>
</html>